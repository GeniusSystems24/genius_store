# طبقة العرض (Presentation Layer)

[![English](https://img.shields.io/badge/Language-English-blueviolet?style=for-the-badge)](README.md)

تنفذ طبقة العرض واجهة المستخدم لتطبيق متجر Genius. تتبع نمط البنية المعمارية MVVM (نموذج-عرض-نموذج العرض) وتستخدم Riverpod لإدارة الحالة.

## الغرض

طبقة العرض:

- تقوم بعرض مكونات واجهة المستخدم والشاشات
- تتعامل مع تفاعلات المستخدم
- تدير حالة واجهة المستخدم من خلال نماذج العرض/المزودين
- تتواصل مع طبقة المجال من خلال حالات الاستخدام
- تنفذ الجوانب المرئية للتطبيق بما في ذلك التخطيطات والرسوم المتحركة والتنقل

## هيكل الدليل

```text
presentation/
├── common_widgets/    # مكونات واجهة المستخدم القابلة لإعادة الاستخدام
├── screens/           # شاشات التطبيق منظمة حسب الميزة
│   ├── auth/          # شاشات المصادقة
│   ├── cart/          # شاشات سلة التسوق
│   ├── checkout/      # شاشات الدفع
│   ├── home/          # الشاشة الرئيسية
│   ├── product/       # شاشات المنتج
│   └── profile/       # شاشات الملف الشخصي
└── providers/         # إدارة الحالة باستخدام Riverpod
```

## نظرة عامة على البنية

تتبع طبقة العرض نمط MVVM مع بعض التعديلات لـ Flutter و Riverpod:

```mermaid
flowchart TB
    subgraph Presentation Layer
        View["الشاشات والأدوات\n(العرض)"]
        ViewModel["المزودين\n(نموذج العرض)"]
    end
    
    subgraph Domain Layer
        UseCase["حالات الاستخدام"]
        Entities["الكيانات"]
    end
    
    View <--> ViewModel
    ViewModel <--> UseCase
    UseCase --> Entities
    View --> Entities
```

### المكونات

#### العرض (الشاشات والأدوات)

- مكونات واجهة المستخدم التي تعرض المعلومات للمستخدم
- تتعامل مع مدخلات المستخدم وترسلها إلى نماذج العرض
- تراقب تغييرات الحالة من المزودين وتعيد البناء وفقًا لذلك
- تنفذ منطق واجهة المستخدم (الرسوم المتحركة، الانتقالات، إلخ)

#### نموذج العرض (المزودين)

- تغلف حالة واجهة المستخدم ومنطق الأعمال
- تتواصل مع طبقة المجال من خلال حالات الاستخدام
- تعالج وتحول البيانات للعرض
- تتعامل مع إدارة الحالة باستخدام Riverpod
- تتوسط بين طبقات العرض والمجال

## إدارة الحالة مع Riverpod

يستخدم التطبيق Riverpod لإدارة الحالة نظرًا لمزاياه:

- حقن التبعيات ونمط محدد موقع الخدمة
- إعادة بناء فعالة مع تفاعلية دقيقة
- قابلية الاختبار من خلال تجاوزات المزود
- تكامل سلس مع العمليات غير المتزامنة

### هيكل المزود

```mermaid
flowchart TD
    FP["مزودي المستقبل/التدفق\n(تحميل البيانات غير المتزامن)"] --> SP["مزودي مخطر الحالة\n(الحالة القابلة للتغيير)"]
    SP --> P["المزودين العاديين\n(حالة للقراءة فقط)"]
    P --> UI["مكونات واجهة المستخدم"]
    FP --> UI
```

### أنواع المزودين

- **مزودي مخطر الحالة**: للحالة القابلة للتغيير (مثل عناصر السلة)
- **مزودي المستقبل/التدفق**: للعمليات غير المتزامنة (مثل جلب المنتجات)
- **المزودين العاديين**: للحالة البسيطة أو العمليات الحسابية (مثل القوائم المفلترة)

## التنقل

يستخدم التطبيق نظام التنقل بين المسارات المسماة في Flutter:

- يتم تحديد المسارات في فئة `AppRouter`
- يتم تنفيذ التنقل باستخدام `Navigator.pushNamed` والطرق ذات الصلة
- يتم تمرير وسيطات المسار إلى الشاشات عبر المعلمة `settings.arguments`

## نظام التصميم

تتبع طبقة العرض نظام تصميم متسق:

- تكوين السمة من `core/theme`
- المكونات القابلة لإعادة الاستخدام في `common_widgets`
- تباعد وطباعة وألوان متسقة

## أفضل الممارسات

يتبع التنفيذ أفضل الممارسات التالية:

1. **فصل المخاوف**: لا تحتوي مكونات واجهة المستخدم على منطق الأعمال
2. **المسؤولية الفردية**: لكل مكون غرض واضح ومركز
3. **إعادة الاستخدام**: يتم استخراج الأدوات الشائعة لإعادة الاستخدام
4. **قابلية الاختبار**: يتم فصل المنطق عن واجهة المستخدم لتسهيل الاختبار
5. **الاتساق**: يتم تنفيذ أنماط واجهة المستخدم المتشابهة بشكل متسق
6. **الاستجابة**: تتكيف واجهة المستخدم مع أحجام الشاشة المختلفة واتجاهاتها
